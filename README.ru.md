## Morph

---

### Описание

Пример реализации gRPC-сервера на Rust, предназначенного для преобразования голоса в векторные представления (эмбеддинги). 
Этот сервис может являться частью поисковой системы, систем векторного анализа, и т.д. 
Он использует офлайн модель (предварительно загруженную), и производит вычисления на CPU (без использования GPU).

P.S. Если хочется включить поддержку вычислений на GPU, это легко сделать, внеся небольшие правки в проект.

### Модели

Данный сервис реализован конкретно под input/output этой модели [TitaNet-L](https://catalog.ngc.nvidia.com/orgs/nvidia/teams/nemo/models/titanet_large).

Сначала необходимо скачать модель, и конвертировать в формат `ONNX`.
Далее её следует положить в директорию `./model` проекта.

### Конфигурация

В `config.yaml` можно устанавливать значение для полей:

- `server.host` - хост для запуска gRPC сервера.
- `server.port` - порт для запуска gRPC сервера.
- `logging.log_level` - уровень детализации логов.
- `embedding.model_path` - путь к модели.

### Использование

При использовании собственного аудиофайла убедитесь, что он имеет правильный формат - WAV PCM_S16LE mono (sample_rate 16000Гц).

В противном случае, вы получите ошибку, так как сервис проверяет аудиофайл на соответствие.
Если у вас установлен `ffmpeg`, вы можете использовать его, для конвертации.

Для отправки запроса на сервер возьмите `voice_embeddings.proto` (из директории `./proto`), и используйте в своем клиенте.
Проверить работоспособность можно например через `Postman`.

Cтруктура запроса для rpc `EmbedVoice`:
```Json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "content": "audio in base64 format"
}
```

В результате распознавания сервер вернёт JSON вида:
```Json
{
  "id": "123e4567-e89b-12d3-a456-426614174000",
  "embeddings": [
    -0.028818072751164436,
    0.04423859715461731,
    -0.004005502909421921,
    "...",
    -0.044924844056367874,
    -0.02066687121987343
  ]
}
```

### Локальный запуск

1) Для установки `Rust` на Unix-подобные системы (MacOS, Linux, ...) - запускаем в терминале команду.
   По окончании загрузки вы получите последнюю стабильную версию Rust для вашей платформы, а так же последнюю версию Cargo.

```shell
curl --proto '=https' --tlsv1.2 -sSf https://sh.rustup.rs | sh
```

2) Для проверки выполните следующую команду в терминале.

```shell
cargo --version
```

3) Открываем проект, и запускаем команды.

Проверяет код на возможность компиляции (без запуска).
```shell
cargo check
```

Сборка + запуск проекта (в режиме релиза с оптимизациями).
```shell
cargo run --release
```

UDP: Если вдруг у вас Windows, посмотрите [Инструкцию тут](https://forge.rust-lang.org/infra/other-installation-methods.html)

### Лицензия

Этот проект лицензируется под [MIT License](https://opensource.org/licenses/MIT) или [Apache License 2.0](https://www.apache.org/licenses/LICENSE-2.0), на ваш выбор.
